{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
    <link rel="stylesheet" href="{% static 'css/common_style.css' %}">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <title>Shop them all!</title>
</head>
<body>
    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">Shop them all</a>
            </div>
            <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            </ul>

            <ul class="nav navbar-nav navbar-right">
                <li><a href="#./login.html"><span class="glyphicon glyphicon-user"></span> Register</a></li>
                <li><a href="./realogin.html"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
                <li><a href = "#"><span class = "glyphicon glyphicon-shopping-cart"><span class = "badge"> X </span></span></a></li>
            </ul>

            <form class="navbar-form navbar-left" action="/search">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search" name="search">

                    <div class="input-group-btn">
                        <button class="btn btn-default" type="submit" onclick="Search">
                            <i class="glyphicon glyphicon-search"></i>
                        </button>
                    </div>

                </div>
            </form>
        </div>
    </nav>
    <div id="wrapper">
        <!-- Sidebar -->
            <nav id="spy">
                <ul id="ShopsUl" class="sidebar-nav nav">
                    <li class="sidebar-brand">
                        <a href=""><span class="fa fa-home solo">Stores</span></a>
                    </li>
                    {%for shop in all_shops%}
                    <li>
                        <a id="{{shop.name}}" onclick="MarkMeOnMap('{{shop.name}}',true)" data-scroll>
                            <span class="fa fa-anchor solo">{{shop.name}}</span>
                        </a>
                    </li>
                    {%endfor%}
                </ul>
            </nav>
    </div>

    <div id="shopMap">
        <img id="imgMap" src = "{% static 'images/map.png'  %}"/>
    </div>




    <footer class="container-fluid text-center">
        <p>@Copyright 2019 ShopThemAll</p>
    </footer>

</body>
</html>

<script type="text/javascript">


    var jsonMap = JSON.parse('{{ shops_map | escapejs }}');
    console.log(jsonMap);

    function removeElementsByClass(className){
      var elements = document.getElementsByClassName(className);
     while(elements.length > 0){
            elements[0].parentNode.removeChild(elements[0]);
     }
    }

     removeElementsByClass('location_pin');

    {%if search_resulted_shop  %}
        var shops_json = JSON.parse('{{ search_resulted_shop | escapejs }}');
        console.log(shops_json);
        shops_json.forEach(function(elem){MarkMeOnMap(elem,false);});

    {%endif%}

    function MarkMeOnMap(shop_name, deletePrev=false)
    {
    console.log(deletePrev);
        if(deletePrev)
            removeElementsByClass('location_pin');
        var img = new Image();
        img.src = "{% static 'images/location_pin.png' %}";
        img.className  = "location_pin";
        var div = document.getElementById('shopMap');

        img.style.width = '45px';
        img.style.height = '45px';

        var a = document.createElement("a");
        a.style.position =  "absolute";
        console.log(shop_name);
        a.style.left = jsonMap[shop_name][0] + document.getElementById('imgMap').offsetLeft + 100  + 'px';
        a.style.top = jsonMap[shop_name][1] + document.getElementById('imgMap').offsetTop + 'px';
        console.log(document.getElementById('imgMap').offsetLeft);
        console.log(document.getElementById('imgMap').offsetTop);

        a.style.width = '45px';
        a.style.height = '45px';
        a.setAttribute("href","shop/"+shop_name);
        a.appendChild(img);
        div.appendChild(a);

    }


</script>